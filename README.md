# SOC-Automation-Lab

## Objective

To automate security operations by creating a SOC using open-source tools like Wazuh, The Hive, and Shuffle. The goal is to streamline incident response, improve threat detection, and enhance overall security posture.

### Skills Learned

- Security Orchestration, Automation, and Response (SOAR): Leveraging tools like Wazuh, The Hive, and Shuffle to automate security processes.
- Threat Detection and Response: Implementing detection mechanisms for threats like malware and privilege escalation.
- Log Analysis and Correlation: Using Wazuh to analyze security logs and identify anomalies.
- Incident Response: Creating automated workflows for incident response, including notification, investigation, and remediation.
- Security Automation: Scripting and automation techniques to streamline security tasks.
- Cloud Security: Configuring and securing cloud environments.
### Tools Used

- Wazuh: Used for security monitoring, log analysis, and threat detection.
- The Hive: Employed for case management and incident response orchestration.
- Shuffle: Utilized for security orchestration, automation, and response (SOAR).
## Steps
## Step - 1 - System architecture

![Screenshot 2024-11-30 124022](https://github.com/user-attachments/assets/51f76d2a-3b5c-478d-8d21-90d13be52972)

This diagram outlines the core components of the SOC automation system and their interactions:

Client Machines: Generate security events and send them to WAZI.

WAZI: Receives and processes security events, triggering alerts for significant incidents.

Shuffle: Enriches alerts and sends them to The Hive for case management.

The Hive: Creates cases for incidents and assigns tasks to SOC analysts.

SOC Analysts: Receive notifications and take necessary actions, such as investigating incidents or implementing countermeasures.

By automating these steps, the SOC can respond to threats more efficiently and effectively.

## Step 2: Setting Up the Virtual Environment

2A. Install Virtualization Software:
Download and install a virtualization software like VirtualBox or VMware Workstation on your host machine.

![Screenshot 2024-11-30 125310](https://github.com/user-attachments/assets/7168b7d2-c020-49b0-9154-d1c8326f9e02)


2B. Create Virtual Machines:

Create two virtual machines:

Windows 10: This machine will act as a client and generate security events.


![Screenshot 2024-11-30 140036](https://github.com/user-attachments/assets/d05a3381-a045-4ed1-a727-0e638bb886f3)


2C. Windows 10: Install Sysmon to collect detailed system activity logs.


![Screenshot 2024-11-30 140611](https://github.com/user-attachments/assets/b36e2032-76ed-41ad-9b2c-a32a2743d0fa)


2D. Create Virtual ubantu servers to host wazuh,hive and shuffle on Digital Ocean.


![Screenshot 2024-11-30 141341](https://github.com/user-attachments/assets/3e56286e-a043-480e-a781-8454a06a13ac)


2E. Install wazuh server on to the virtual machine and log in using the generated credentials.

![Screenshot 2024-11-30 141529](https://github.com/user-attachments/assets/d658127a-7f37-4ec0-b81b-75fef414941b)


![image](https://github.com/user-attachments/assets/967fd413-c7fd-43d4-8dd9-bf119f8a59b2)

2F. Create a virtual server for Hive and install Hive on the Virtual machine.

![Screenshot 2024-11-30 142104](https://github.com/user-attachments/assets/3640a3dc-a0d5-4bba-91dc-48a006e7c45d)

2G. configure Hive to listen on the local machine IP address.

![Screenshot 2024-12-01 103857](https://github.com/user-attachments/assets/ad3fc1da-7e82-41d2-a03a-0bc2e9ce7f68)




## Step - 3 - Deploy agents on the wazuh manager console.

![Screenshot 2024-12-01 104507](https://github.com/user-attachments/assets/f7d3fd46-deca-48ec-9aec-844c81897865)

![Screenshot 2024-12-01 104724](https://github.com/user-attachments/assets/f9570d97-1d81-41ba-801e-1a9df684fd5b)

Check and confirm if the wazuh agent is deployed.

![Screenshot 2024-12-01 104818](https://github.com/user-attachments/assets/ff051df7-6ff8-4029-aa1b-410ef712f50f)

## Step - 4 - Generate telementary and injest into wazuh.

4A. Find the OSEC.conf file generated by sysmon on your wazuh agent machine to find the generated activity on the machine.


![Screenshot 2024-12-01 105311](https://github.com/user-attachments/assets/5cb16836-e14f-4ba3-8f89-f4692e40113c)

4B. Restart your wazuh server on your target machine and open wazuh to find the activity logs from sysmon.

![Screenshot 2024-12-01 105709](https://github.com/user-attachments/assets/853a7dba-fee7-4c72-b9c2-d5198fe0b782)

4C. Disable Microsoft defender and install mimikatz on to the machine to test.

![Screenshot 2024-12-01 110229](https://github.com/user-attachments/assets/3fccf296-023e-4086-9bc0-0e250795dc45)


4D. Run the Mimikatz file on the machine and check the wazuh server.

![Screenshot 2024-12-01 110339](https://github.com/user-attachments/assets/c24c8a03-c8da-4113-b572-5f2aa7c7fc82)

4E. Search mimikatz on your wazuh server and find the generated logs.

![Screenshot 2024-12-01 110748](https://github.com/user-attachments/assets/b1a01c93-2b76-436e-a7d1-872568e42485)



## Step - 5 - Create custom rules to generate a alert for the malicious file of mimikatz.

![Screenshot 2024-12-01 111314](https://github.com/user-attachments/assets/6907a76e-ca4b-41a4-820e-a4b0389ac44d)

![Screenshot 2024-12-01 111603](https://github.com/user-attachments/assets/387a9757-f90d-4b44-8ea6-7eb79a0b00bc)

5A. Test the rule by executed the mimikatz file on the agent machine.

![Screenshot 2024-12-01 111728](https://github.com/user-attachments/assets/d00df239-87d5-4ffb-bf71-2796b80f82a9)

